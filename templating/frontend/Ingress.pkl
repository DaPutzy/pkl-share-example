extends ".../Feature.pkl"

annotations: Mapping<String, String>

output {
  value = new Listing {
    for (tenant in module.tenants) {
      when (tenant.frontend != null) {
        new {
          apiVersion = "networking.k8s.io/v1"
          kind = "SimplifiedIngressForThisExampleProject"
          name = "example-app-ingress-" + tenant.name
          annotations {
            ["kubernetes.io/tls-acme"] = "\(tenant.frontend.useAcme)"
            ...module.annotations
          }
          hosts = tenant.frontend.domain
          secretName = tenant.frontend.secret ?? "example-\(tenant.name)-tls-secret"
        }
      }
    }
  }
  renderer = new YamlRenderer {
    isStream = true
  }
}
